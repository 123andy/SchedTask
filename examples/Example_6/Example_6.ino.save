// Example_6 - Illustrating various Types passed as parameters to a dispatched task/function using SchedTaskT

/*
	This sketch provides examples of various types that can be passed to dispatched functions.

	Notice that passing a vector is one way to pass multiple parameters (of the same Type) to a dispatched function.

	For the complete series of tutorials see
	https://www.youtube.com/watch?v=nZHBbSkVUSo&list=PL69rZyCQYu-SrPAZUc2Lj_zsjPLxtI9fv

	For this example see
	https://www.youtube.com/watch?v=wWlGXLyDJOs

Change Log

	4/18/2020 8:19PM Initial Release
	05/17/2020 20:54 moved ExampleConstants.h
	05/18/2020 10:25 added default constructor example
*/

const char CAPTION[] = "Example 6 Types";

#include <ExampleConstants.h>										// contains various constants used to control the sketch behavior
#include <SchedTask.h> // added 9/28/20
#include <SchedTaskT.h>

// parms used to pass to dispatched functions
int parm1 = 9;															// integer
int& rParm1 = parm1;													// int reference
double duble = 3.14;													// double
String s = "Hello World";											// String object
int arr[3] = {3, 2, 1};												// array of ints
//SchedBase* schedArr[2];												// array of SchedBase pointers
SchedTaskTparm schedArr[2]; // array of SchedTask pointers

// function declarations required before reference in SchedTaskT constructors
void task1(int);
void task2(int&);
void task3(double);
void task4(String);
//void task5(SchedBase*);
void task5(SchedTaskTparm);
void task6(int*);
//void task7(SchedBase**);
//void task7(SchedBase*);
void task7(SchedTaskTparm*);

// Examples of passing various Types of parameters to dispatched tasks

SchedTaskT<int> Task1 (1000, ONESHOT, task1, parm1);		// pass an int

SchedTaskT<int&> Task2 (1000 + INTERVAL, ONESHOT, task2, rParm1); // pass ref to int

SchedTaskT<double> Task3 (1000 + 2*INTERVAL, ONESHOT, task3, duble);	// pass a double

SchedTaskT<String> Task4 (1000 + 3*INTERVAL, ONESHOT, task4, s);	// pass a String

//SchedTaskT<SchedBase*> Task5 (1000 +4*INTERVAL, ONESHOT, task5, &Task5); // pass pointer to the SchedBase (base class)
SchedTaskT<SchedTaskTparm> Task5 (1000 + 4*INTERVAL, ONESHOT, task5, reinterpret_cast<SchedTaskTparm>(&Task5));
//SchedTaskT<SchedTaskT<>*> Task5 (1000 +4*INTERVAL, ONESHOT, task5, &Task5); // pass pointer to the SchedBase (base class)
//SchedTaskT<SchedBase*>*

SchedTaskT<int*> Task6 (1000 + 5*INTERVAL, ONESHOT, task6, arr);	// pass an array of ints

//SchedTaskT<SchedBase**> Task7 (1000 + 6*INTERVAL, ONESHOT, task7, schedArr);	// pass an array of SchedTask pointers
SchedTaskT<SchedTaskTparm*> Task7 (1000 + 6*INTERVAL, ONESHOT, task7, schedArr);

SchedTaskT<int> Empty; // call the default constructor for object Empty; you must 'fill in' with member function calls

/********************  Setup() **************************/

void setup() {

	Serial.begin(UART_SPEED);										// init the Monitor window
	Serial << "\n*** SchedTask " << CAPTION << " ***\n";	// Welcome message to monitor

//	schedArr[1] = &Task6;											// init that SchedTask
	schedArr[1] = reinterpret_cast<SchedTaskTparm>(&Task6);
}

/******************* Loop() ********************************/

void loop() {
	SchedBase::dispatcher();										// run the dispatcher continuously
}

/********************* Functions ************************************/

void task1(int i) {
	Serial << "\nint " << i << " was passed to task1";
}

void task2(int& rInt) {
	Serial << "\nint& " << rInt << " was passed to task2";
}

void task3(double dub) {
	Serial << "\ndouble " << dub << " was passed to task3";
}

void task4(String s) {
	Serial << "\n" << s << " was passed to task4";
}

void task5(SchedTaskTparm pBase) {
	Serial << "\npointer to SchedBase was passed to task5";
// I should be able to change func and parm here (parm would be a different Task pointer)
	pBase->setPeriod(200);												// use pointer to scheduled task to alter its period
	Serial << "\nperiod = " << pBase->getPeriod() << " (200 now because it was changed)";		// example of calling member function of SchedBase
//	pBase->setFunc(&task6);												// use pointer to scheduled task to alter the function to dispatch
	pBase->setFunc(&task5);
}
// added 0/28/20
void task5b(SchedTaskTparm p) {;}

void task6(int* arr) {
	Serial << "\narr[0] = " << arr[0] << " was passed to task6";
}

void task7(SchedTaskTparm* schedArr) { // changed 9/28/20

	Serial << "\nschedArr[1] next = " << (int)schedArr[1]->getNext() << " was passed to task7 (-1 now because it was a one-shot Task)";
}

void task9(int) {														// get and set the parameter

	int parm1 = Task1.getParm();
	Task1.setParm(parm1 + 5);

}
